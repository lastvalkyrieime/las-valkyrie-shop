<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las Valkyrie - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #e94560;
        }

        .header p {
            color: #ccc;
        }

        .admin-panel {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .products-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #e94560;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #ff6b81;
            transform: translateY(-2px);
        }

        .btn-edit {
            background: #4ecdc4;
        }

        .btn-edit:hover {
            background: #67e6dc;
        }

        .btn-delete {
            background: #ff6b6b;
        }

        .btn-delete:hover {
            background: #ff8e8e;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #e94560;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #e94560;
        }

        .product-category {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 5px;
        }

        .product-stock {
            font-size: 0.9rem;
            color: #ffd93d;
            margin-bottom: 15px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 12px;
        }

        .stock-control {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .stock-control input {
            width: 80px;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: #4ecdc4;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ff6b6b;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî´ Las Valkyrie - Admin Panel</h1>
            <p>Management System untuk Senjata, Armor, dan Equipment</p>
        </div>

        <div class="admin-panel">
            <!-- Form Input Produk -->
            <div class="form-section">
                <h2>Tambah Produk Baru</h2>
                <form id="productForm">
                    <div class="form-group">
                        <label for="productName">Nama Produk</label>
                        <input type="text" id="productName" required placeholder="Contoh: M4A1 Assault Rifle">
                    </div>

                    <div class="form-group">
                        <label for="productCategory">Kategori</label>
                        <select id="productCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="senjata">üî´ Senjata</option>
                            <option value="peluru">üì¶ Amunisi</option>
                            <option value="armor">ü¶∫ Armor</option>
                            <option value="attachment">‚öôÔ∏è Attachment</option>
                            <option value="ganja">üåø Ganja</option>
                            <option value="meth">üíä Meth</option>
                            <option value="alat_rampok">üîß Alat Rampok</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="productPrice">Harga (Rp)</label>
                        <input type="number" id="productPrice" required placeholder="Contoh: 1500000" min="0">
                    </div>

                    <div class="form-group">
                        <label for="productStock">Stok Awal</label>
                        <input type="number" id="productStock" required placeholder="Contoh: 10" min="0">
                    </div>

                    <div class="form-group">
                        <label for="productDescription">Deskripsi (Opsional)</label>
                        <textarea id="productDescription" rows="3" placeholder="Deskripsi produk..."></textarea>
                    </div>

                    <button type="submit" id="submitBtn">Tambah Produk</button>
                    <button type="button" id="updateBtn" class="btn-edit hidden">Update Produk</button>
                    <button type="button" id="cancelBtn" class="btn-delete hidden">Batal</button>
                </form>
            </div>

            <!-- Daftar Produk -->
            <div class="products-section">
                <h2>Daftar Produk</h2>
                <div class="products-grid" id="productsGrid">
                    <div class="loading">Memuat produk...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // Konfigurasi API - SESUAIKAN DENGAN URL BACKEND ANDA
        const API_BASE_URL = 'https://las-valkyrie-backend.vercel.app/api';
        let editingProductId = null;

        // Kategori dengan emoji
        const categoryEmojis = {
            'senjata': 'üî´',
            'peluru': 'üì¶', 
            'armor': 'ü¶∫',
            'attachment': '‚öôÔ∏è',
            'ganja': 'üåø',
            'meth': 'üíä',
            'alat_rampok': 'üîß'
        };

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${isError ? 'error' : ''} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Load semua produk
        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE_URL}/products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    displayProducts(result.data);
                } else {
                    throw new Error(result.error || 'Gagal memuat produk');
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showNotification('Gagal memuat produk: ' + error.message, true);
                document.getElementById('productsGrid').innerHTML = '<p>Error memuat produk</p>';
            }
        }

        // Display produk di grid
        function displayProducts(products) {
            const grid = document.getElementById('productsGrid');
            
            if (!products || products.length === 0) {
                grid.innerHTML = '<p>Tidak ada produk tersedia</p>';
                return;
            }

            grid.innerHTML = products.map(product => `
                <div class="product-card" data-id="${product._id}">
                    <div class="product-header">
                        <div class="product-name">${categoryEmojis[product.category] || 'üì¶'} ${product.name}</div>
                    </div>
                    <div class="product-category">${getCategoryLabel(product.category)}</div>
                    <div class="product-price">${formatCurrency(product.price)}</div>
                    <div class="product-stock">Stok: ${product.stock}</div>
                    <div class="product-actions">
                        <button class="btn-edit btn-small" onclick="editProduct('${product._id}')">Edit</button>
                        <button class="btn-delete btn-small" onclick="deleteProduct('${product._id}')">Hapus</button>
                    </div>
                    <div class="stock-control">
                        <input type="number" id="stock-${product._id}" placeholder="Jumlah" min="1" max="${product.stock}">
                        <button class="btn-small" onclick="updateStock('${product._id}', 'decrease')">Kurangi Stok</button>
                    </div>
                    <div class="stock-control">
                        <input type="number" id="add-stock-${product._id}" placeholder="Tambah stok" min="1">
                        <button class="btn-small" onclick="updateStock('${product._id}', 'increase')">Tambah Stok</button>
                    </div>
                </div>
            `).join('');
        }

        // Get category label
        function getCategoryLabel(category) {
            const labels = {
                'senjata': 'Senjata',
                'peluru': 'Amunisi',
                'armor': 'Armor', 
                'attachment': 'Attachment',
                'ganja': 'Ganja',
                'meth': 'Meth',
                'alat_rampok': 'Alat Rampok'
            };
            return labels[category] || category;
        }

        // Tambah produk baru
        async function addProduct(productData) {
            try {
                const response = await fetch(`${API_BASE_URL}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || result.message || 'Gagal menambah produk');
                }

                showNotification('Produk berhasil ditambahkan!');
                resetForm();
                loadProducts();
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Gagal menambah produk: ' + error.message, true);
            }
        }

        // Edit produk
        async function editProduct(productId) {
            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}`);
                if (!response.ok) throw new Error('Gagal memuat data produk');
                
                const result = await response.json();
                const productData = result.data || result;

                // Isi form dengan data produk
                document.getElementById('productName').value = productData.name;
                document.getElementById('productCategory').value = productData.category;
                document.getElementById('productPrice').value = productData.price;
                document.getElementById('productStock').value = productData.stock;
                document.getElementById('productDescription').value = productData.description || '';

                // Tampilkan tombol update dan sembunyikan tombol submit
                document.getElementById('submitBtn').classList.add('hidden');
                document.getElementById('updateBtn').classList.remove('hidden');
                document.getElementById('cancelBtn').classList.remove('hidden');

                editingProductId = productId;
                
            } catch (error) {
                console.error('Error editing product:', error);
                showNotification('Gagal memuat data produk', true);
            }
        }

        // Update produk
        async function updateProduct(productId, productData) {
            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || result.message || 'Gagal update produk');
                }

                showNotification('Produk berhasil diupdate!');
                resetForm();
                loadProducts();
            } catch (error) {
                console.error('Error updating product:', error);
                showNotification('Gagal update produk: ' + error.message, true);
            }
        }

        // Hapus produk
        async function deleteProduct(productId) {
            if (!confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Gagal menghapus produk');
                }
                
                showNotification('Produk berhasil dihapus!');
                loadProducts();
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Gagal menghapus produk: ' + error.message, true);
            }
        }

        // Update stok
        async function updateStock(productId, action) {
            const inputField = action === 'decrease' 
                ? document.getElementById(`stock-${productId}`)
                : document.getElementById(`add-stock-${productId}`);
                
            const amount = parseInt(inputField.value);

            if (!amount || amount <= 0) {
                showNotification('Masukkan jumlah yang valid', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}/stock`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        amount: amount
                    })
                });

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || result.message || 'Gagal update stok');
                }

                showNotification(`Stok berhasil di${action === 'increase' ? 'tambah' : 'kurangi'}!`);
                inputField.value = '';
                loadProducts();
            } catch (error) {
                console.error('Error updating stock:', error);
                showNotification('Gagal update stok: ' + error.message, true);
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('productForm').reset();
            document.getElementById('submitBtn').classList.remove('hidden');
            document.getElementById('updateBtn').classList.add('hidden');
            document.getElementById('cancelBtn').classList.add('hidden');
            editingProductId = null;
        }

        // Event Listeners
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseInt(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value
            };

            if (editingProductId) {
                updateProduct(editingProductId, productData);
            } else {
                addProduct(productData);
            }
        });

        document.getElementById('updateBtn').addEventListener('click', function() {
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseInt(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value
            };

            updateProduct(editingProductId, productData);
        });

        document.getElementById('cancelBtn').addEventListener('click', resetForm);

        // Load products saat page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            
            // Test koneksi backend
            fetch(`${API_BASE_URL}/products`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Backend tidak merespon');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Backend connected successfully');
                })
                .catch(error => {
                    console.error('Backend connection failed:', error);
                    showNotification('Koneksi ke backend gagal!', true);
                });
        });
    </script>
</body>
</html>
